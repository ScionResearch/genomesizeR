<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="genomesizeR">
<title>Method description • genomesizeR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Method description">
<meta property="og:description" content="genomesizeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">genomesizeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.0001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/compare_methods.html">Comparing estimation methods</a>
    <a class="dropdown-item" href="../articles/example.html">Example</a>
    <a class="dropdown-item" href="../articles/input_output.html">About the input and the output</a>
    <a class="dropdown-item" href="../articles/methods.html">Method description</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Method description</h1>
            
      
      
      <div class="d-none name"><code>methods.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="bayesian-method">Bayesian method<a class="anchor" aria-label="anchor" href="#bayesian-method"></a>
</h2>
<p>The NCBI database of species with known genome sizes was split by
superkingdom (Bacteria, Archeae, Eukaryotes). A distributional Bayesian
linear hierarchical model using the <code>brm</code> function from the
<code>brms</code> package was fitted to each superkingdom dataset. The
general model structure is outlined below.</p>
<p><span class="math display">\[\begin{gather*}
log(G_i) \sim \mathcal{N}(\mu_i, \sigma_{i}^2)
\end{gather*}\]</span></p>
<p>where <span class="math inline">\(G_i\)</span> is the genome size of
species <span class="math inline">\(i\)</span> in the units of 10 Mbp.
The model uses predictors for both mean and standard deviation. The mean
is modelled as follows:</p>
<p><span class="math display">\[\begin{gather*}
\mu_i = \alpha_0 + \alpha_{genus_{g[i]}} + \alpha_{family_{f[i]}} +
\alpha_{order_{o[i]}} + \alpha_{class_{c[i]}} +
\alpha_{phylum_{p[i]}}  \\
\alpha_{genus_{g[i]}} \sim \mathcal{N}(0, \sigma_{genus}^2) \\
\alpha_{family_{f[i]}} \sim \mathcal{N}(0, \sigma_{family}^2) \\
\alpha_{order_{o[i]}} \sim \mathcal{N}(0, \sigma_{order}^2) \\
\alpha_{class_{c[i]}} \sim \mathcal{N}(0, \sigma_{class}^2) \\
\alpha_{phylum_{p[i]}} \sim \mathcal{N}(0, \sigma_{phylum}^2) \\
\end{gather*}\]</span></p>
<p>The following prior distributions are used:</p>
<p><span class="math display">\[\begin{gather*}
\alpha_0 \sim \mathcal{N}(0,5) \\
(\sigma_{genus},\sigma_{family},\sigma_{order},\sigma_{class},\sigma_{phylum},s_{class},s_{phylum})
\sim \mathcal{N}^+(0,1) \\
\end{gather*}\]</span></p>
<p>Differences in genome size variability was observed among taxa,
therefore the model also adds predictors to the standard deviation of
the response. The standard deviation is modelled as follows:</p>
<p><span class="math display">\[\begin{gather*}
log(\sigma_{i}) = \lambda_0 + \lambda_{class_{c[i]}} +
\lambda_{phylum_{p[i]}} \\
\lambda_{class_{c[i]}} \sim \mathcal{N}(0, s_{class}^2) \\
\lambda_{phylum_{p[i]}} \sim \mathcal{N}(0, s_{phylum}^2) \\
\end{gather*}\]</span></p>
<p>with priors</p>
<p><span class="math display">\[\begin{gather*}
\lambda_0 \sim \mathcal{N}(0,1) \\
(s_{class},s_{phylum}) \sim \mathcal{N}^+(0,1) \\
\end{gather*}\]</span></p>
<p><span class="math inline">\(\mathcal{N}^+\)</span> is the normal
distribution truncated to positive values. <span class="math inline">\(g[i]\)</span>,<span class="math inline">\(f[i]\)</span>,<span class="math inline">\(o[i]\)</span>,<span class="math inline">\(c[i]\)</span> and <span class="math inline">\(p[i]\)</span> are respectively the index for the
genus, family, order, class, and phylum of entry <span class="math inline">\(i\)</span> in the species-level database. Note
that taxonomic groups are naturally nested within each other and the
indices are designed to be unique to the particular taxonomic group it
represents.</p>
<p>The estimation process uses Stan’s Hamiltonian Monte Carlo algorithm
with the U-turn sampler.</p>
<p>Posterior predictions are obtained using the <code>predict</code>
function from the <code>brms</code> package, and 95% credible intervals
are obtained using 2.5% and 97.5% quantiles from the posterior
distribution.</p>
<p>Queries corresponding to identified species with an available genome
size estimate in the NCBI database get allocated the genome size value
of the database (averaged at the species level) and 95% confidence
intervals are calculated as XXX</p>
</div>
<div class="section level2">
<h2 id="frequentist-method">Frequentist method<a class="anchor" aria-label="anchor" href="#frequentist-method"></a>
</h2>
<p>A frequentist linear mixed-effects model using the <code>lmer</code>
function from the <code>lme4</code> package was fitted to the NCBI
database of species with known genome sizes. The model is as
follows:</p>
<p><span class="math display">\[\begin{gather*}
log(G_i) =  \alpha_0 + \alpha_{genus_{g[i]}} +  \alpha_{family_{f[i]}} +
e_i \\
\end{gather*}\]</span> where <span class="math inline">\(\alpha_0\)</span> is the overall mean, <span class="math inline">\(\alpha_{genus_{g[i]}}\)</span> and <span class="math inline">\(\alpha_{family_{f[i]}}\)</span> are random effect
of genus and family for genus <span class="math inline">\(g[i]\)</span>
and family <span class="math inline">\(f[i]\)</span> and <span class="math inline">\(e_i\)</span> is the residual error of observation
<span class="math inline">\(i\)</span>.</p>
<p>The estimation process using the restricted maximum likelihood method
(REML). A prediction interval is computed using the
<code>predictInterval</code> function from the <code>merTools</code>
package. As higher nested levels (order, class) are not taken into
account in the model, predictions are not produced for queries above the
family level.</p>
</div>
<div class="section level2">
<h2 id="weighted-mean-method">Weighted mean method<a class="anchor" aria-label="anchor" href="#weighted-mean-method"></a>
</h2>
<p>The weighted mean method computes the genome size of a query by
averaging the known genome sizes of surrounding taxa in the taxonomic
tree, with a weighted system where further neighbours have less weight
in the computed mean. The identification of related taxa is limited to
levels below and including order.</p>
<p>For queries relating to well-characterised species where many genetic
studies have been performed, such as model organisms, this might lead to
more precise predictions than the two other methods. This method can
also perform better than the others if your queries consist of lists of
taxa (for example, an output of <em>blastn</em> where several matches
can be obtained for each query). Otherwise, we suggest using one of the
other methods, as the confidence intervals calculated are less reliable
for the weighted mean method.</p>
<div class="section level4">
<h4 id="pseudocode-describing-the-weighted-mean-method-computation">Pseudocode describing the weighted mean method computation:<a class="anchor" aria-label="anchor" href="#pseudocode-describing-the-weighted-mean-method-computation"></a>
</h4>
<pre><code># 1. Build table of parent information

for each match (a query can be a list of matches e.g. blast result):
  get the taxid associated
  get the list of parents and their ranks
  for each parent :
    if higher than order rank: 
      STOP and return 'Not enough genome size references for close taxa'
    if genome size associated with that taxon in the reference database:
      store it in a 'parent information table'
      store the distance as well (number of nodes between query and this taxon)
      if we have more than one genome that contributed to the data we have in the 'parent information table':
        STOP the iteration through parents here
    if the query is a list of matches and we have reached their common ancestor:
      STOP the iteration through parents here

# 2. Compute weighted mean from the table of parent information

estimated_size = 0
estimated_standard_error = 0
sum_weights = 0
for each line of parent information:
  weight = 1.0/(distance+1)
  sum_weights = sum_weights + weight
  estimated_size = estimated_size + weight * genome_size
  estimated_standard_error = estimated_standard_error + (weight * precomputed_standard_error)**2
estimated_size = estimated_size / sum_of_all_weights
standard_error = square_root(estimated_standard_error)
Z = 1.96 # 95% CI
margin_of_error = Z * standard_error
confidence_interval_lower = estimated_size - margin_of_error
confidence_interval_upper = estimated_size + margin_of_error</code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Celine Mercier, Joane Ellouet.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
